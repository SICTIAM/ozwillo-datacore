<!--  
 doc, with mini online playground using swagger.js client
 see http://developers-blog.helloreverb.com/the-fastest-way-to-connect-to-an-api-with-javascript/

 TODO rather using templating (through JAXRS providers) ?? ex. handlebars.js like Atol,
 see https://github.com/pole-numerique/oasis/blob/master/oasis-webapp/src/main/java/oasis/web/view/HandlebarsBodyWriter.java
 -->

Allows to manage (CRUD) and find Data Resources and their Models using JSON/HTTP REST calls.
<br/><br/>
&nbsp;&nbsp;- <b>Data Resources</b> are handled in <a href="http://json-ld.org/">JSON-LD</a>-like 
(implicit context) format (see also <a href="http://json-ld.org/playground/index.html">
playground</a>) and with <b>W3C LDP</b> (Linked Data Platform, see 
<a href="https://dvcs.w3.org/hg/ldpwg/raw-file/tip/ldp-primer/ldp-primer.html">primer</a> and 
<a href="http://www.w3.org/2012/ldp/wiki/Main_Page">wiki</a>)-like operations (URIs, 
future collection filtering (<a href="http://www.w3.org/2012/ldp/wiki/LDPNext">1</a>, 
<a href="http://lists.w3.org/Archives/Public/public-ldp-wg/2012Dec/0030.html">2</a>)
-inspired finders etc.). <b>Have a look at existing Resources, at</b> 
<a href="/dc/type/pli:city_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/pli:city_0</a> for instance for resources in the 
<span class="dcjsonline">
pli:city_0</span> Model type (meaning version 0 of the pli:city Model). 
In addition to the simpler default native pure JSON format, "true" JSON-LD formats and semantic web formats (such as 
<a href="http://en.wikipedia.org/wiki/Resource_Description_Framework">RDF</a>, see 
<a href="/dc/type/pli:city_0" class="dclink" onclick="
javascript:return findDataByTypeRdf($(this).attr('href'));
">example</a>) are available. 
<br/><br/>
&nbsp;&nbsp;- <b>Data Models</b> describe what kinds of Data Resources are allowed in a 
<a href="http://json-schema.org/">JSON Schema</a>-like structure (see 
<a href="http://jsonschema.net/">jsonschema.net playground</a>) with 
<span class="dcjsonline">
string, boolean, int, float, long, double, date, map, list, i18n, resource
</span> fields grouped in reusable <b>Mixin</b> types. 
<b>Have a look at known Models at</b> <a href="/dc/type/dcmo:model_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/dcmo:model_0</a> and Mixins at <a href="/dc/type/dcmi:mixin_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/dcmi:mixin_0</a>, 
in their own metamodel <a href="#exploreMetamodel">where they may be introspected (see how)</a>,
but also drafted and published (<b>upcoming</b>).
<br/><br/>
<a href="https://github.com/pole-numerique/oasis-datacore/wiki">See wiki</a> for further 
examples, FAQ, how to & common use cases, cookbook (writing clients...) and full documentation.
<p>
<div class="dc-import-subtitle">Datacore (<span class="dcConf_baseUrl json dcjsonline">NOT INITED</span>) :</div>
<span class="json dcjsonline"><input type="text" id="myurl" class="myurl json dcjsonline" style="padding: 0; width: 620px" value="/dc/type/dcmo:model_0"></span>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()));">GET</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, 50, {'X-Datacore-View':' '});" title="List view (view : empty i.e. minimal : @id, o:version)">l</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, 25, {'X-Datacore-View':'dc:DubclinCore_0'});" title="List view (view : dc:DubclinCore_0)">dc</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, null, {'X-Datacore-Debug':'true'});" title="Debug / explain query">?</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, null, {'Accept':'text/x-nquads'});" title="RDF N-Quads output">RDF</button>
<button onclick="javascript:return editOrPostData(encodeUri($('.myurl').val()));" id="editOrPost" title="edit data, then post changes">edit</button>
<button onclick="javascript:return setUrl('');" title="Reset URL">X</button><br/>
<div class="block response_body">
<a id="mydata"></a><!-- displays a short error message in red -->
<pre id="mynoteditabledata" class="json dcjsonarea"><code id="mydata" class="mydata"></code></pre>
<textarea id="myeditabledata" style="display: none" class="json dcjsonarea myeditabledata"></textarea>
</div>
</p>
See <a href="#playgroundUserManual">this Playground's user manual below</a> and
<a href="https://github.com/pole-numerique/oasis-datacore/wiki/Playground-&-Import-UI-demo-scenario---Provto-&-OpenElec">its tutorial on wiki</a>.
<p></p>
<p></p>

<b>To add your own data</b> using REST calls, you must first define or reuse the appropriate business-specific Models.
You can do both using the <a href="./import/index.html">Import UI</a> (see samples there including OpenElec's, and
<a href="https://github.com/pole-numerique/oasis-datacore/wiki/Playground-&-Import-UI-demo-scenario---Provto-&-OpenElec">documentation on wiki</a>),
or using Java (see
<a href="https://github.com/pole-numerique/oasis-datacore/tree/master/oasis-datacore-rest-server/src/main/java/org/oasis/datacore/sample">
Provto sample</a>), or do it any other way that still follows the
<a href="https://github.com/pole-numerique/oasis-datacore/blob/master/oasis-datacore-rest-server/src/main/java/org/oasis/datacore/sample/DatacoreSampleMethodologyBase.java">
methodology</a>. Basically, this means :
provide a denormalized extract of your data, define Models for it, group related fields together in Mixins,
define their ID definition policy and link them using resource fields, define referencing mixin fields and default values,
find out which Models already exist and reconcile with them (or do it beforehands).
<br/><br/>
<b>To use it from your own business application,</b> use the JSON/HTTP client of your own business application's platform
and / or of your choice to call the Datacore API server using REST JSON/HTTP calls. See
<a href="https://github.com/pole-numerique/oasis-datacore/blob/master/README.md">README</a> for details on alternatives
(the Datacore CXF Java client, any other Java JAXRS-compatible client, swagger.js in javascript, swagger codegen in any other language).
<br/><br/>

<h1>API Details</h1>
<b>This endpoint</b> has for base URL <span class="dcConf_baseUrl_link">NOT INITED</span> 
(URL that must be called by clients using HTTP) 
and for container URL <span class="dcConf_containerUrl_link">NOT INITED</span> 
(URL that must be used to build Datacore Data resource URIs).
<br/><br/>
<b>URIs</b> that uniquely identify Datacore Data resource are in the form
<span class="dcjsonline">$containerUrl/dc/type/$type/$iri</span>, where 
$containerUrl is unique for a container (ex. http://data.ozwillo.com), $type is 
among available model types and $iri is the resource's Internal Resource Identifier (IRI). 
<br/><br/>
&nbsp;&nbsp;- IRIs have 3 constraints : they must be valid URL endings, unique (not enforced yet), 
and if possible readable and representative of the resource.
<br/><br/>
&nbsp;&nbsp;- URIs must be <a href="http://perishablepress.com/stop-using-unsafe-characters-in-urls/">
valid URLs</a> meaning that all non safe characters (beyond <span class="dcjsonline">[0-9a-zA-Z]$-_.+!*'()</span>
including reserved characters <span class="dcjsonline">$&+,/:;=?@</span>
<a href="http://blog.lunatech.com/2009/02/03/what-every-web-developer-must-know-about-url-encoding">
outside of their purpose</a> such as '?' within <span class="dcjsonline">$type</span>)
must be URL-encoded, and it's bad practice for model names to contain some.<br/><br/>
&nbsp;&nbsp;- URIs of embedded Resources (as sub Resource within another top level Resource)
are by default <span class="dcjsonline">$containerUrl/dc/type/$subResourceType/$resourceIri/$subResourceJsonPath</span>,
but can be something else if parsing is defined consistently within $subResourceType.
<br/><br/>
<b>Values</b> are formatted in JSON as follows :
<br/><br/>
&nbsp;&nbsp;- <span class="dcjsonline">date</span> as <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO8601</a>
such as <span class="dcjsonline">"2014-01-08T09:31:19.062Z"</span>, <span class="dcjsonline">"2014-01-08T10:31:19.062+01:00"</span>.
Put your (data or application) timezone in your dates so that they can be shared across the world while staying readable for your local use case.
<br/><br/>
&nbsp;&nbsp;- <span class="dcjsonline">long</span> and <span class="dcjsonline">double</span> as string
<br/><br/>
&nbsp;&nbsp;- <span class="dcjsonline">i18n</span> as a list of translation objects (like JSONLD), for instance :
<span class="dcjsonline">[{"v": "Torino", "l": "it"}, {"v": "Turin","l": "fr"}]</span>.
It allows language-agnostic lookups such as 
<a href="/dc/type/pli:city_0?pli:name_i18n.v=Torino" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/pli:city_0?pli:name_i18n.v=Torino</a>
or the shorter version
<a href="/dc/type/pli:city_0?pli:name_i18n=Torino" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/pli:city_0?pli:name_i18n=Torino</a>
, but also language-scoped lookups such as
<a href="#" class="dclink" onclick="
javascript:return findDataByType($(this).text());
">/dc/type/pli:city_0?pli:name_i18n=$elemMatch{"v":"Torino","l":"it"}</a>
<br/><br/>
<b>Operations</b> are specified in details below within the Swagger UI playground, and especially
<a href="#!/dc/postAllDataInType_post_0" target="_blank">"postAllDataInType" for typed updates</a> (version) and
<a href="#!/dc/findDataInType_get_2" target="_blank">"findDataInType" for typed queries</a> (criteria, sort, ranged query- or iterator-based pagination, debug mode, view).
<br/><br/>
<b>Typed operations</b> where type of data is provided in URL are usually more efficient : 
'*inType' methods are faster, finder queries with type even more.
<br/><br/>

<strong>Authentication:</strong>
<br/>&nbsp;&nbsp;- In production (and integration), OASIS Kernel OAuth2 authentication must be used, i.e. 
<a href="https://github.com/pole-numerique/oasis-datacore/wiki/How-to-use-OAuth2-with-Datacore">
HTTP requests' Authorization header must be "Bearer &lt;valid OAuth2 Bearer 
/ Access Token&gt;"</a> (see <a href="https://github.com/pole-numerique/oasis-datacore/wiki/How-to-authenticate-to-kernel-oauth2">how to get one</a>).
<br/>&nbsp;&nbsp;- In dev mode, there is a mock authentication system that supports Basic Auth 
(i.e. HTTP requests' Authorization header must be "Basic &lt;base 64-encoding of username:password&gt;"), 
for a few users without password, see available ones in 
<a href="https://github.com/pole-numerique/oasis-datacore/blob/master/oasis-datacore-rest-server/src/main/resources/oasis-datacore-security-mock-context.xml">
configuration</a>.
<br/>&nbsp;&nbsp;- Datacore API's Swagger UI allows to provide said Authorization header, 
with a default value that logs as admin in dev mode.
<br/><br/>

<a id="exploreMetamodel"></a>
<h1>Explore available models and projects</h1>
A <b>project</b> is a business-consistent set of models and their resources, and can see
those of its visible projects (its dependencies). All interactions occur within the context of
the current project, but some may be prevented : for instance, it usually forbidden to write models
in another project than the current one. A project can have forked URIs i.e. that cannot be
seen in visible projects, which mostly allows to <b>fork models</b> i.e. redefine / override
its own version of a model. 
<br/><br/>
To <b>start exploring available models</b>, select your chosen project (i.e. the point of view
that you wish to explore from, ex. <span class="dcjsonline">geo_1</span> for geographical
jurisdictions such as countries and cities) or merely the default <span class="dcjsonline">oasis.main</span>
project in the dropdown above the Playground UI. This will display in the Playground
result output its project portal, i.e. the <b>list of storage models</b> (ex. in <span class="dcjsonline">geo_1</span>
<a href="/dc/type/dcmo:model_0/geo:Area_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">geo:Area_0</a>
) and for each of them a link to models they store (ex.
<a href="/dc/type/dcmo:model_0?dcmo:storageModel=geo:Area_0" class="dclink" onclick="
javascript:return findData($(this).attr('href'), null, null, null, 25, {'X-Datacore-View':' '});
">models stored in geo:Area_0</a>
), and the list of <b>pure mixins</b> (not mandatorily stored in a single storage model)
and for each of them a link to models that use them as mixins, that are local to the
selected project. Note that this is why there are none in the <span class="dcjsonline">geo</span>
project, which makes resources and models of <span class="dcjsonline">geo_1</span> visible
but doesn't have any of its own.
<br/><br/>
Further, <b>querying models as Resources</b> allows to know in which Model type(s) a given kind
of Resources can be queried, for instance :
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <a href="/dc/type/dcmo:model_0?dcmo:globalMixins=pl:place_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">dcmo:globalMixins=pl:place_0</a> : lists Models that describe a location i.e. have a pl:shape WKS point, 
such as : 
<a href="/dc/type/dcmo:model_0/co:company_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">co:company_0</a>, 
whose WKS can then be retrieved, for instance by 
GET <a href="/dc/type/co:company_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/co:company_0</a> .
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <a href="/dc/type/dcmo:model_0?dcmo:globalFields.dcmf:name=plo:name" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">dcmo:globalFields.dcmf:name=plo:name</a> : lists Models that "officially" have a country 
(i.e. having the "official" field for a country in Ozwillo Datacore), and that can therefore be queried on that, 
such as : 
<a href="/dc/type/dcmo:model_0/plo:country_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">plo:country_0</a>, 
<a href="/dc/type/dcmo:model_0/pli:city_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">pli:city_0</a>, 
<a href="/dc/type/dcmo:model_0/co:company_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">co:company_0</a>, 
<a href="/dc/type/dcmo:model_0/cityareauseit:urbanAreaDestinationOfUse_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">cityareauseit:urbanAreaDestinationOfUse_0</a>, 
<a href="/dc/type/dcmo:model_0/cityarea:cityArea_0" class="dclink" onclick="
javascript:return getData($(this).attr('href'));
">cityarea:cityArea_0</a> , 
which can then be queried by country, for instance by 
GET <a href="/dc/type/plo:country_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/plo:country_0</a>, 
GET <a href="/dc/type/pli:city_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/pli:city_0</a>, 
GET <a href="/dc/type/co:company_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/co:company_0</a>, 
GET <a href="/dc/type/cityareauseit:urbanAreaDestinationOfUse_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/cityareauseit:urbanAreaDestinationOfUse_0</a> 
and GET <a href="/dc/type/cityarea:cityArea_0" class="dclink" onclick="
javascript:return findDataByType($(this).attr('href'));
">/dc/type/cityarea:cityArea_0</a>.
<br/><br/>
<b>Here are the generic projects :</b>
<br/>
&nbsp;&nbsp;- <span class="dcjsonline">oasis.main</span> is the default project
and shows all current stable versions of projects of public interest,
<br/>
&nbsp;&nbsp;- <span class="dcjsonline">oasis.meta</span>
contains the metamodel and is visible by all other projects,
<br/>
&nbsp;&nbsp;- <span class="dcjsonline">oasis.sample</span>
contains unit test technical samples,
<br/>
&nbsp;&nbsp;- <span class="dcjsonline">oasis.sandbox</span> can be used by
anyone to test the Datacore with its own models and resources, especially in the Import UI.
<br/><br/>
<b>Here are some of the most often reused projects :</b>
<br/>
&nbsp;&nbsp;- <span class="dcjsonline">geo_1</span> (major version 1)
contains all geographical jurisdictions (such as countries and cities), while <span class="dcjsonline">geo</span>
makes its current stable version visible whatever its number,
<br/>
&nbsp;&nbsp;- <span class="dcjsonline">org_1</span> (major version 1)
contains all public and private organizations as well as persons and also sees <span class="dcjsonline">geo_1</span>,
while <span class="dcjsonline">org</span> makes its current stable version visible whatever its number.
<br/><br/>

<a id="playgroundUserManual"></a>
<h1>Playground User Manual</h1>
(See also <a href="https://github.com/pole-numerique/oasis-datacore/wiki/Playground-&-Import-UI-demo-scenario---Provto-&-OpenElec">its tutorial on wiki</a>.)
<br/><br/>
&nbsp;&nbsp;- <b>click on a URI's id</b> to go to the Resource it is the URI of.
<br/><br/>
&nbsp;&nbsp;- <b>click on <span class="dcjsonline">type</span> in a URI
or on an item of the <span class="dcjsonline">@type</span> list</b>
to go to the corresponding model definition.
<br/><br/>
&nbsp;&nbsp;- <b>click on a property name</b> to similarly go to the model that defines it.
<br/><br/>
&nbsp;&nbsp;- <b>click on <span class="dcjsonline">:</span></b> between a property's key and value to query
all other resources with the same value for this property in the same model type.
<br/><br/>
&nbsp;&nbsp;- <b>click on <span class="dcjsonline">/</span></b> between a URI's model type and id to look for
resources that refer (link) to it : if it's a metamodel it queries its resources,
otherwise it lists all models that define a <span class="dcjsonline">resource</span>
field that links to it through its model type at top level or in a top level
<span class="dcjsonline">list</span> field, and provides links allowing to do
the same at further depth below top level and for other mixins besides its model type.
<br/><br/>
&nbsp;&nbsp;- <b>project portal</b> : select another project in the dropdown above the Playground
(see details on <a href="#exploreMetamodel">how to explore its available (meta)models</a>).
<br/><br/>
&nbsp;&nbsp;- <b>query line</b> : write there the relative URI of a single Resource
or of a LDP-like Datacore query (see documentation below in Swagger UI of operation <a href="#!/dc/findDataInType_get_2" target="_blank">
<span class="dcjsonline">findDataInType</span> for typed queries</a> (criteria, sort, ranged query- or iterator-based pagination).
<br/><br/>
&nbsp;&nbsp;- <b>buttons</b> : roll your mouse over them to see what they do.
<br/><br/>

<h1>This server's configuration</h1>
<pre><code>
## Development mode (also allows to set system property datacore.dropdb=true ex. in maven)
datacore.devmode=<span class="dcConf_devmode">NOT INITED</span>

## Shard Endpoint - full URL (for clients...)
datacoreApiServer.baseUrl=<span class="dcConf_baseUrl">NOT INITED</span>

## Container - default URL (for URIs...)
datacoreApiServer.containerUrl=<span class="dcConf_containerUrl">NOT INITED</span>

## Other (or all) known Datacores (comma-separated container URLs)
datacoreApiServer.knownDatacoreContainerUrls=<span class="dcConf_knownDatacoreContainerUrls">NOT INITED</span>

## Query :
## default maximum number of documents to scan when fulfilling a query, overriden by
## DCFields', themselves limited by DCModel's. 0 means no limit (for tests), else ex.
## 1000 (secure default), 100000 (on query-only nodes using secondary & timeout)... 
## http://docs.mongodb.org/manual/reference/operator/meta/maxScan/
datacoreApiServer.query.maxScan=<span class="dcConf_queryMaxScan">NOT INITED</span>
## default maximum start position
datacoreApiServer.query.maxStart=<span class="dcConf_queryMaxStart">NOT INITED</span>
## default maximum number of documents returned
datacoreApiServer.query.maxLimit=<span class="dcConf_queryMaxLimit">NOT INITED</span>
## default number of documents returned
datacoreApiServer.query.defaultLimit=<span class="dcConf_queryDefaultLimit">NOT INITED</span>

## Kernel Configuration
kernel.baseUrl=<span class="dcConf_kernelBaseUrl">NOT INITED</span>
</code></pre>
<br/><br/>
