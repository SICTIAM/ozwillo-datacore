<!DOCTYPE html>
<html>
<head>
  <title>Datacore Import UI</title>
  <link href='//fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'/>
  <link href='../css/highlight.default.css' media='screen' rel='stylesheet' type='text/css'/>
  <link href='../css/screen.css' media='screen' rel='stylesheet' type='text/css'/>
  <link href='../common/css/datacore-ui.css' rel='stylesheet' type='text/css'/>
  <script type="text/javascript" src="../lib/shred.bundle.js" /></script>  
  <script src='../lib/jquery-1.8.0.min.js' type='text/javascript'></script>
  <script src='../lib/jquery.slideto.min.js' type='text/javascript'></script>
  <script src='../lib/jquery.wiggle.min.js' type='text/javascript'></script>
  <script src='../lib/jquery.ba-bbq.min.js' type='text/javascript'></script>
  <script src='../lib/handlebars-1.0.0.js' type='text/javascript'></script>
  <script src='../lib/underscore-min.js' type='text/javascript'></script>
  <script src='../lib/backbone-min.js' type='text/javascript'></script>
  <script src='../lib/swagger.js' type='text/javascript'></script>
  <script src='../swagger-ui.js' type='text/javascript'></script>
  <script src='../lib/highlight.7.3.pack.js' type='text/javascript'></script>
  <script src='../common/lib/datacore-base.js' type='text/javascript'></script>
  <script src='../common/lib/datacore-ui.js' type='text/javascript'></script>
  <script src='lib/papaparse.js' type='text/javascript'></script>
  <script src='lib/moment-with-locales.min.js' type='text/javascript'></script>
  <script src="lib/hashids.min.js" type="text/javascript"></script>
  <script src='lib/datacore-import.js' type='text/javascript'></script>
  <script type="text/javascript">
     
   var inited = false; // OASIS
    $(function () {
      if (inited) { // OASIS
         return; // OASIS else called at EACH reload including each CSV parsing !! 
      } // OASIS
      
      initPlayground(); // also window.dcApi
      
      // update model domain prefix on file change :
      $('.modelFile').change(function(e){
         $in=$(this);
         ///$in.next().html($in.val());
         $('.domainPrefix').val(buildModelDomainPrefix($in.val()));
      });
  });
   
   function getImportStateConf() {
      return {
            domainPrefix : $(".domainPrefix").val(), // changed by UI on model file select to its first three letters, else elec
            model : {
               fileName : $(".modelFile").val(),
               file : $(".modelFile"),
               rowLimit : parseInt($(".modelRowLimit").val(), 10)
            },
            data : {
               fileName : $(".resourceFile").val(),
               file : $(".resourceFile"),
               rowLimit : parseInt($(".resourceRowLimit").val(), 10),
               rowStart : parseInt($(".resourceRowStart").val(), 10),
               detailedErrors : $('.resourceDetailedErrors').is(':checked') 
            }
      };
   }

  </script>
</head>

<body>

<div id=dc-header>
<div class="dc-ui-wrap">
   <a class="dc-logo" href="http://oasis-eu.org">OASIS - Datacore Import UI</a>
   <div class="dc-ui-userinfo">
      <div class='input' id="userinfo"></div>
      <div class='input'><a id="logout" href="#">logout</a></div>
   </div>
</div>
</div>

<div id="dc-ui-container" class="dc-ui-wrap">

<div class="dc-import-section">
<div class="dc-import-subtitle">Models :</div>
<span title="Used to generate model prefixes">Model domain prefix</span> :
<input type="text" class="domainPrefix" value="elec" style="width: 50px"/>
&nbsp;&nbsp;&nbsp;&nbsp;
<span title="-1 means all (default)">Model row limit</span> :
<input type="text" class="modelRowLimit" value="-1" style="width: 50px"/>
<br/><br/>
<input type="file" class="modelFile"/>
&nbsp;&nbsp;&nbsp;&nbsp;
samples :
<a href="samples/model_template.csv">empty template</a>
(<a href="samples/model_template.ods">.odt</a>),
OpenElec
<a href="samples/openelec/oasis-donnees-metiers-openelec.csv">v0.1</a>,
Geo Hierarchy
<a href="samples/geohier/geo_model.csv">v0.1</a>,
<a href="samples/geohier/v10/Territorial_jurisdiction_model2_mdutoo.csv">v0.10</a> (i18n, NUTS2/3),
<a href="samples/geohier/v14/Territorial_jurisdiction_model2_mdutoo.csv">v0.14</a>,
Geo Mapping
<a href="samples/geomap/cityPlanning.csv">v0.2</a>
<br/><br/>
<span class="json dcjsonarea modelRowCounter">Handled no model row yet</span>&nbsp;&nbsp;
<span class="json dcjsonarea modelCounter">Posted no model yet</span>
</div>

<div class="dc-import-section">
<div class="dc-import-subtitle">Data :</div>
<span title="-1 means all">Resource row limit</span> :
<input type="text" class="resourceRowLimit" value="50" style="width: 50px"/>
&nbsp;&nbsp;&nbsp;&nbsp;
<span title="0 means at the beginning">start</span> :
<input type="text" class="resourceRowStart" value="0" style="width: 50px"/>
&nbsp;&nbsp;&nbsp;&nbsp;
<span title="provides in error log : resources parsed in row">detailed errors</span> :
<input type="checkbox" class="resourceDetailedErrors" checked="checked"/>
<br/><br/>
<input type="file" class="resourceFile"/>
&nbsp;&nbsp;&nbsp;&nbsp;
samples :
OpenElec
<a href="samples/openelec/electeur_v26010_sample.csv">v0.1</a>,
Geo Hierarchy
<a href="samples/geohier/geo_data_samplefrit.csv">v0.1</a>,
v0.10
<a href="samples/geohier/v10/Territorial_jurisdiction_model2_mdutoo_data.csv">fr & it</a>
<a href="samples/geohier/v10/Territorial_jurisdiction_model2_mdutoo_datatk.csv">tk</a>,
v0.14
<a href="samples/geohier/v14/Territorial_jurisdiction_model2_mdutoo_datafr.csv">fr</a>
<a href="samples/geohier/v14/Territorial_jurisdiction_model2_mdutoo_datait.csv">it</a>
<a href="samples/geohier/v14/Territorial_jurisdiction_model2_mdutoo_dataes.csv">es</a>
<a href="samples/geohier/v14/Territorial_jurisdiction_model2_mdutoo_datatk.csv">tk</a>,
Geo Mapping
v0.2
<a href="samples/geomap/cityPlanning_data_cityareait.csv">cityareait</a>
<a href="samples/geomap/cityPlanning_data_coitateco.csv">coitateco</a>
<a href="samples/geomap/cityPlanning_data_coit.csv">coit</a>
<br/><br/>
<span class="json dcjsonarea resourceRowCounter">Handled no resource row yet</span>&nbsp;&nbsp;
<span class="json dcjsonarea resourceCounter">Posted no resource yet</span>
</div>

<div class="dc-import-section">
<button class="dc-import-button" onclick="javascript:return importModelAndResources(getImportStateConf());"><b>import</b></button>
&nbsp;(clicking button with no file selected uses OpenElec sample files)
<br/><br/>
<b>WARNING if Resources that depend on others are not imported, click button again</b>
(because for now Resources are not imported all at once nor ordered according to their dependencies).
<br/><br/>
To get more info about import errors, for now open your browser's javascript console.
<br/><br/>
<b>Quickstart: </b>
Line 2 of <a href="samples/model_template.csv">empty template</a>
(<a href="samples/model_template.ods">.odt</a>)
contains the reference documentation for all model features. Look on the
<a href="https://github.com/pole-numerique/oasis-datacore/wiki/Playground-%26-Import-UI-demo-scenario---Provto-%26-OpenElec">wiki</a>
for a step-by-step tutorial, the Phase 1 / 2 methodology, gotchas, more details...
<br/><br/>
Model & data CSV files must be <b>UTF-8</b> encoded and use <b>comma</b> as separator. For this, the best way is
to edit them using <a href="http://www.libreoffice.org/">LibreOffice</a>. <b>Beware</b>, MS Excel uses
Windows encoding and semicolon separator instead (see
<a href="https://support.office.com/en-za/article/Import-or-export-text-txt-or-csv-files-5250ac4c-663c-47ce-937b-339e391393ba">how to configure Excel</a>),
Google Doc Spreadsheet can help instead but migrating between different spreadsheet
softwares (such as Google Doc's) often breaks files (ex. "true" becomes VRAI, "false" becomes "0").
</div>


<div class="dc-import-section">

<div class="dc-import-subtitle">CSV rows :</div>
<div class="block response_body">
<pre class="json dcjsonarea"><code id="importedJsonFromCsv" class="importedJsonFromCsv"></code></pre><!-- dcjsonarea -->
</div>

<a id="importedResourcesFromCsv"></a>
<div class="dc-import-subtitle">Resources :</div>
<div class="block response_body">
<pre class="json dcjsonarea"><code id="importedResourcesFromCsv" class="importedResourcesFromCsv"></code></pre><!-- dcjsonarea -->
</div>

<a id="datacoreResources"></a>
<div class="dc-import-subtitle">Datacore :</div>
<span class="json dcjsonline">GET <span class="dcConf_baseUrl">NOT INITED</span><input type="text" id="myurl" class="myurl json dcjsonline" style="padding: 0; width: 480px"></span>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()));">go</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, 50, {'X-Datacore-View':' '});" title="List view (view : empty i.e. minimal : @id, o:version)">l</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, 25, {'X-Datacore-View':'dc:DubclinCore_0'});" title="List view (view : dc:DubclinCore_0)">dc</button>
<button onclick="javascript:return findData(encodeUri($('.myurl').val()), null, null, null, null, {'X-Datacore-Debug':'true'});" title="Debug / explain query">?</button>
<button onclick="javascript:return findDataByTypeRdf(encodeUri($('.myurl').val()));">RDF</button>
<button onclick="javascript:return setUrl('');" title="Reset">X</button><br/>
<div class="block response_body">
<a id="mydata"></a><!-- displays a short error message in red -->
<pre class="json dcjsonarea"><code id="mydata" class="mydata"></code></pre>
</div>

</div>

</div>

</body>

</html>
